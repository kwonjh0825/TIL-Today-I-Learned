## HTTP의 특징

- 비 연결 지향
    - 서버는 요청에 대한 응답을 보낸 후 연결을 끊음
- 무상태
    - 연결을 끊는 순간 클라이언트와 서버 간 통신이 끝나며 상태 정보가 유지되지 않음
    - 장바구니에 담은 상품을 유지 불가, 로그인 상태 유지 불가 등 단점

## Cookie

- 서버가 사용자의 웹 브라우저에 전송하는 작은 데이터 조각
- 클라이언트 측에서 저장되는 작은 데이터 파일
- 사용자 인증, 사용자 추적, 상태 유지 등에 사용되는 데이터 저장 방식

### 쿠키 사용 예시

- 브라우저(클라이언트)는 쿠키를 로컬에 key-value 형식으로 저장
- 쿠키를 저장해 놓았다가 동일한 서버에 재 요청 시 저장된 쿠키를 함께 전송
- 두 요청이 동일한 브라우저에서 들어왔는지를 판단할 때 주로 사용
    - 이를 이용해 사용자의 로그인 상태 유지(상태 없는 HTTP 프로토콜에서 상태 정보를 기억시켜 주기 때문)

### 쿠키 사용 목적

- 세션 관리
    - 로그인, 아이디 자동완성, 공지 하루 안보기, 팝업 체크, 장바구니 등 정보 관리
- 개인화
    - 사용자 선호, 테마 설정
- 트래킹
    - 사용자 행동 기록, 분석

### 세션

- 서버 측에서 생성되어 클라이언트와 서버 간의 상태 유지
- 상태 정보를 저장하는 데이터 저장 방식
- 쿠키에 세션 데이터를 저장하여 매 요청시마다 세션 데이터를 함께 보냄

### 세션 작동 예시

- 클라이언트가 로그인 하면 서버가 세션 데이터를 생성 후 저장(DB)
- 생성된 세션 데이터에 인증할 수 있는 session id 발급
- 발급한 session id를 클라이언트에게 응답
- 클라이언트는 응답 받은 session id를 쿠키에 저장
- 클라이언트가 다시 동일한 서버에 접속하면 요청과 함께 쿠키(session id가 저장된) 를 서버에 전달
- 쿠키는 요청마다 서버에 함께 전송되므로 서버에서 session id 를 확인해 로그인되어 있다는 것을 알도록 함

### 쿠키 종류 별 수명

- session cookie
    - 현재 세션이 종료되면 삭제됨
    - 브라우저 종료와 함께 세션이 삭제됨
- persistent cookie
    - expires 속성에 지정된 날짜 혹은 Max-Age 속성에 지정된 기간이 지나면 삭제됨

## Django Authentication System

- 사용자 인증과 관련된 기능을 모아 놓은 시스템
- 인증과 권한 부여를 함께 제공 및 처리

## Custom User Model로 대체하기

- django가 기본적으로 제공하는 user model은 내장된 auth 모듈의 User 클래스 사용
- 과정
    1. AbstractUser를 상속받는 커스텀 User 클래스 작성
    2. django 프로젝트가 사용하는 기본 User 모델을 우리가 작성한 User 모델로 지정
    3. admin.py 에 등록
- Django 는 새 프로젝트를 시작하는 경우 커스텀 User 모델을 설정하는 것을 강력하게 권장
    - 기본 User 모델과 동일하게 작동하면서도 필요한 경우 나중에 맞춤 설정할 수 있기 때문

## Login

- 세션을 create 하는 과정

### AuthenticationForm()

- 로그인을 위한 built-in form

### login(request, user)

- 인증된 사용자를 로그인 하는 함수

### get_user()

- AuthenticationForm의 인스턴스 메서드
- 유효성 검사를 통과했을 경우 로그인한 사용자 객체 반환

## Logout

- 세션을 delete 하는 과정

### logout(request)

- 현재 요청에 대한 세션 데이터를 DB에서 삭제
- 클라이언트의 쿠키에서도 sessionid 삭제

## Template with Authentication

### context processor

- 템플릿이 렌더링 될 때 호출 가능한 context 데이터 목록
- 작성된 context 데이터는 기본적으로 템플릿에서 사용 가능한 변수로 퐇마됨
- django 에서 자주 사용하는 데이터 목록을 미리 템플릿에 로드 해둔 것