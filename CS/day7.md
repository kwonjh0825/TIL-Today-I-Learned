## 경쟁 상태(Race Condition)

- 공유 자원에 대해 여러 프로세스가 동시에 접근을 시도할 때, 타이밍이나 순서가 결과에 영향을 줄 수 있는 상태
- 자료의 일관성을 해치는 결과가 나타날 수 있음
- 임계 영역(Critical Section)
  - 둘 이상의 스레드가 동시에 접근할 수 없도록 보장해야 하는 영역

### 임계 영역 문제 해결을 위한 3가지 조건

- 상호 배제(Mutual Exclusion)
  - 하나의 프로세스가 임계 영역에 있다면 다른 프로세스는 들어갈 수 없음
- 진행(Progress)
  - 임계 영역에 들어간 프로세스가 없는 상태에서 들어가려는 프로세스가 여러 개라면 어느 것이 들어갈 지 결정해야 함
- 한정 대기(Bounded Waiting)
  - 다른 프로세스의 starvation을 방지하기 위해, 한 번 임계구역에 들어간 프로세스는 다음 번 임계 영역에 들어갈 때 제한 필요

## 교착 상태(Deadlock)

- 두 개 이상의 작업이 서로 상대방의 작업이 끝나기를 기다리고 있는 상태
- 결과적으로 아무 것도 완료되지 못하는 상태
- Deadlock 해결법은 크게 예방, 회피, 탐지 및 회복의 3가지 종류로 나뉨

### 교착 상태의 조건

- 상호 배제(Mutual Exclusion)
  - 한 번에 하나의 프로세스만 자원을 사용
- 점유 대기(Hold and wait)
  - 프로세스가 할당된 자원을 가진 상태에서 다른 자원을 기다림
- 비선점(No preemption)
  - 프로세스가 어떤 자원의 사용을 끝낼 때까지 그 자원을 뺏을 수 없음
- 순환 대기(Circular wait)
  - 각 프로세스는 순환적으로 다음 프로세스가 요구하는 자원을 가지고 있음

### 교착 상태 방지(Deadlock Prevention)

- 교착상태 발생조건 4가지 중 하나라도 발생하지 않도록 하는 것
- 각각의 조건을 부정하여 교착상태 발생 가능성 차단
- 방식
  - 상호배제 방지
    - 한번에 여러 프로세스가 공유 자원을 사용할 수 있도록 함
    - 동기화 관련 문제 발생 가능
  - 점유 대기 방지
    - 프로세스 실행에 필요한 모든 자원을 한번에 요구하고 허용할 때까지 작업 보류. 이후 다른 자원을 점유하기 위한 대기 조건을 성립하지 않도록 함
  - 비선점 조건 방지
    - 이미 다른 프로세스에게 할당된 자원이 선점권이 없다고 가정할 때, 높은 우선순위의 프로세스가 해당 자원을 선점할 수 있도록 함
  - 순환 대기 조건 방지
    - 일정한 한 방향으로만 자원을 요구할 수 있도록 함
- 시스템의 처리량이나 효율성을 떨어트리는 단점 발생 가능

### 교착상태 회피(Deadlock Avoidance)

- 안정 상태(Safe state)
  - 프로세스들이 요청하는 모든 자원을 교착 상태를 발생시키지 않으면서 차례로 모두에게 할당할 수 있는 상태
- 안정 순서(Safe sequence)
  - 프로세스에게 자원을 할당, 실행, 종료 등의 작업을 할 때 교착 상태가 발생하지 않는 특정 순서
- 불안정 상태
  - 안정 상태가 아닌 상황
  - 즉 교착상태 발생 가능성이 있는 상황
- 자원을 할당한 후에도 시스템이 항상 안정 상태를 유지하도록 할당을 허용하는 것이 특징
- 대표적 알고리즘으로 은행원 알고리즘
  - 다익스트라가 제안한 기법
  - 어떤 자원의 할당을 허용하는지 여부를 결정하기 전 미리 결정된 모든 자원들의 최대 가능한 할당량을 가지고 시뮬레이션 해서 안정 상태에 들 수 있는지 여부 검사

### 교착상태 탐지 및 회복(Detection, Recovery)

- 탐지 기법
  - Allocation, Request, Available 등으로 교착 상태가 발생했는지 여부 탐색
  - 자원 할당 그래프를 통해 탐지하는 방법도 있음
- 회복 기법
  - 교착상태를 탐지 기법으로 탐지했다면 순환 대기에서 벗어나 교착상태를 회복하기 위한 방법
  - 방식
    - 프로세스 1개 이상 중단
      - 교착상태에 빠진 모든 프로세스를 중단
        - 연산중이던 프로세스들도 모두 일시에 중단되어 부분 결과가 폐기될 수 있는 단점
      - 프로세스를 하나씩 중단시킬 때마다 탐지 알고리즘을 통해 교착 상태를 탐지하며 회복
        - 매번 탐지 알고리즘을 수행해야 하므로 부담이 될 수 있음
    - 자원 선점
      - 프로세스에 할당된 자원을 선점하여 교착상태를 해결할 때까지 그 자원을 다른 프로세스에 할당